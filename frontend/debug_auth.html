<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Authentication Debug</title>
  </head>
  <body>
    <h1>Authentication Debug Tool</h1>
    <div id="results"></div>

    <script>
      function debugAuth() {
        const results = document.getElementById("results");

        // Test login API call
        const testLogin = async () => {
          try {
            const response = await fetch("http://127.0.0.1:8000/api/login/", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                email: "test@example.com",
                password: "test123",
              }),
            });

            const data = await response.json();
            console.log("Login response:", data);

            results.innerHTML += "<h3>Login Response:</h3>";
            results.innerHTML +=
              "<pre>" + JSON.stringify(data, null, 2) + "</pre>";

            // Test token storage
            if (data.access_token) {
              localStorage.setItem("access_token", data.access_token);
              localStorage.setItem("refresh_token", data.refresh_token);
              localStorage.setItem("user", JSON.stringify(data.user));

              results.innerHTML += "<h3>Tokens Stored:</h3>";
              results.innerHTML +=
                "<p>Access Token: " +
                localStorage.getItem("access_token") +
                "</p>";
              results.innerHTML +=
                "<p>Refresh Token: " +
                localStorage.getItem("refresh_token") +
                "</p>";
              results.innerHTML +=
                "<p>User: " + localStorage.getItem("user") + "</p>";

              // Test authentication check
              const isAuthenticated = () => {
                const token = localStorage.getItem("access_token");
                return !!token;
              };

              results.innerHTML += "<h3>Authentication Check:</h3>";
              results.innerHTML +=
                "<p>Is Authenticated: " + isAuthenticated() + "</p>";
            }
          } catch (error) {
            console.error("Login error:", error);
            results.innerHTML += "<h3>Error:</h3>";
            results.innerHTML += "<p>" + error.message + "</p>";
          }
        };

        testLogin();
      }

      // Run debug on page load
      debugAuth();
    </script>
  </body>
</html>
